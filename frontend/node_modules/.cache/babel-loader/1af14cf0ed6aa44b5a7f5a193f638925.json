{"ast":null,"code":"// Client-side bookings service with server fallback\nconst KEY = 'nearme_bookings';\nimport { getServerBookings, addServerBooking, removeServerBooking } from './api';\nfunction isAuthenticated() {\n  return !!localStorage.getItem('token');\n}\nfunction parsePrice(priceStr) {\n  if (!priceStr) return 0;\n  const s = String(priceStr).trim();\n  if (/free/i.test(s)) return 0;\n  // extract first number sequence (handles ranges like \"৳ 800 – 1,200\")\n  const m = s.replace(/,/g, '').match(/(\\d+)/);\n  return m ? Number(m[0]) : 0;\n}\nexport function getBookings() {\n  // If authenticated, try server first\n  if (isAuthenticated()) {\n    try {\n      // this returns a promise in async contexts; keep sync fallback\n      // consumers usually call getBookings synchronously, so use local cache\n      const raw = localStorage.getItem(KEY) || '[]';\n      return JSON.parse(raw);\n    } catch (err) {\n      return [];\n    }\n  }\n  try {\n    const raw = localStorage.getItem(KEY) || '[]';\n    return JSON.parse(raw);\n  } catch (err) {\n    return [];\n  }\n}\nexport function saveBookings(list) {\n  localStorage.setItem(KEY, JSON.stringify(list || []));\n}\nexport function addBooking(item) {\n  if (!item) return;\n  // if authenticated, use server API\n  if (isAuthenticated()) {\n    try {\n      const price = parsePrice(item.price);\n      const payload = {\n        itemId: String(item.id),\n        title: item.title,\n        img: item.img,\n        duration: item.duration,\n        price: price,\n        priceLabel: item.price\n      };\n      return addServerBooking(payload).then(res => {\n        // keep local cache in sync\n        saveBookings(res.bookings || []);\n        return res.bookings || [];\n      }).catch(() => {\n        // fallback to local\n        const bookings = getBookings();\n        const exists = bookings.find(b => b.id === item.id);\n        if (exists) return bookings;\n        const price = parsePrice(item.price);\n        const record = {\n          id: item.id,\n          title: item.title,\n          price,\n          priceLabel: item.price,\n          img: item.img,\n          duration: item.duration\n        };\n        bookings.push(record);\n        saveBookings(bookings);\n        return bookings;\n      });\n    } catch (err) {\n      // fallback to local\n    }\n  }\n  if (!item) return;\n  const bookings = getBookings();\n  // avoid duplicate booking with same id\n  const exists = bookings.find(b => b.id === item.id);\n  if (exists) return bookings;\n  const price = parsePrice(item.price);\n  const record = {\n    id: item.id,\n    title: item.title,\n    price,\n    priceLabel: item.price,\n    img: item.img,\n    duration: item.duration\n  };\n  bookings.push(record);\n  saveBookings(bookings);\n  return bookings;\n}\nexport function removeBooking(id) {\n  if (isAuthenticated()) {\n    return removeServerBooking(String(id)).then(res => {\n      saveBookings(res.bookings || []);\n      return res.bookings || [];\n    }).catch(() => {\n      const bookings = getBookings().filter(b => b.id !== id);\n      saveBookings(bookings);\n      return bookings;\n    });\n  }\n  const bookings = getBookings().filter(b => b.id !== id);\n  saveBookings(bookings);\n  return bookings;\n}\nexport function clearBookings() {\n  saveBookings([]);\n}\nexport function getTotal() {\n  return getBookings().reduce((s, b) => s + (b.price || 0), 0);\n}\nexport default {\n  getBookings,\n  addBooking,\n  removeBooking,\n  clearBookings,\n  getTotal\n};","map":{"version":3,"names":["KEY","getServerBookings","addServerBooking","removeServerBooking","isAuthenticated","localStorage","getItem","parsePrice","priceStr","s","String","trim","test","m","replace","match","Number","getBookings","raw","JSON","parse","err","saveBookings","list","setItem","stringify","addBooking","item","price","payload","itemId","id","title","img","duration","priceLabel","then","res","bookings","catch","exists","find","b","record","push","removeBooking","filter","clearBookings","getTotal","reduce"],"sources":["C:/Users/User/Desktop/NM adventures V3 temp/frontend/src/services/bookings.js"],"sourcesContent":["// Client-side bookings service with server fallback\r\nconst KEY = 'nearme_bookings';\r\nimport { getServerBookings, addServerBooking, removeServerBooking } from './api';\r\n\r\nfunction isAuthenticated() {\r\n  return !!localStorage.getItem('token');\r\n}\r\n\r\nfunction parsePrice(priceStr) {\r\n  if (!priceStr) return 0;\r\n  const s = String(priceStr).trim();\r\n  if (/free/i.test(s)) return 0;\r\n  // extract first number sequence (handles ranges like \"৳ 800 – 1,200\")\r\n  const m = s.replace(/,/g, '').match(/(\\d+)/);\r\n  return m ? Number(m[0]) : 0;\r\n}\r\n\r\nexport function getBookings() {\r\n  // If authenticated, try server first\r\n  if (isAuthenticated()) {\r\n    try {\r\n      // this returns a promise in async contexts; keep sync fallback\r\n      // consumers usually call getBookings synchronously, so use local cache\r\n      const raw = localStorage.getItem(KEY) || '[]';\r\n      return JSON.parse(raw);\r\n    } catch (err) {\r\n      return [];\r\n    }\r\n  }\r\n  try {\r\n    const raw = localStorage.getItem(KEY) || '[]';\r\n    return JSON.parse(raw);\r\n  } catch (err) {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport function saveBookings(list) {\r\n  localStorage.setItem(KEY, JSON.stringify(list || []));\r\n}\r\n\r\nexport function addBooking(item) {\r\n  if (!item) return;\r\n  // if authenticated, use server API\r\n  if (isAuthenticated()) {\r\n    try {\r\n      const price = parsePrice(item.price);\r\n      const payload = { itemId: String(item.id), title: item.title, img: item.img, duration: item.duration, price: price, priceLabel: item.price };\r\n      return addServerBooking(payload).then(res => {\r\n        // keep local cache in sync\r\n        saveBookings(res.bookings || []);\r\n        return res.bookings || [];\r\n      }).catch(() => {\r\n        // fallback to local\r\n        const bookings = getBookings();\r\n        const exists = bookings.find(b => b.id === item.id);\r\n        if (exists) return bookings;\r\n        const price = parsePrice(item.price);\r\n        const record = { id: item.id, title: item.title, price, priceLabel: item.price, img: item.img, duration: item.duration };\r\n        bookings.push(record);\r\n        saveBookings(bookings);\r\n        return bookings;\r\n      });\r\n    } catch (err) {\r\n      // fallback to local\r\n    }\r\n  }\r\n  if (!item) return;\r\n  const bookings = getBookings();\r\n  // avoid duplicate booking with same id\r\n  const exists = bookings.find(b => b.id === item.id);\r\n  if (exists) return bookings;\r\n  const price = parsePrice(item.price);\r\n  const record = {\r\n    id: item.id,\r\n    title: item.title,\r\n    price,\r\n    priceLabel: item.price,\r\n    img: item.img,\r\n    duration: item.duration\r\n  };\r\n  bookings.push(record);\r\n  saveBookings(bookings);\r\n  return bookings;\r\n}\r\n\r\nexport function removeBooking(id) {\r\n  if (isAuthenticated()) {\r\n    return removeServerBooking(String(id)).then(res => {\r\n      saveBookings(res.bookings || []);\r\n      return res.bookings || [];\r\n    }).catch(() => {\r\n      const bookings = getBookings().filter(b => b.id !== id);\r\n      saveBookings(bookings);\r\n      return bookings;\r\n    });\r\n  }\r\n  const bookings = getBookings().filter(b => b.id !== id);\r\n  saveBookings(bookings);\r\n  return bookings;\r\n}\r\n\r\nexport function clearBookings() {\r\n  saveBookings([]);\r\n}\r\n\r\nexport function getTotal() {\r\n  return getBookings().reduce((s, b) => s + (b.price || 0), 0);\r\n}\r\n\r\nexport default { getBookings, addBooking, removeBooking, clearBookings, getTotal };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}