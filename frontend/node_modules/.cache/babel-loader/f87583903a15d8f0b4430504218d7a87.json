{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\CSE425 mp\\\\NM adventures Final (1)\\\\NM adventures Final\\\\frontend\\\\src\\\\pages\\\\Chat.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { getChatMessages, postChatMessage } from '../services/api';\nimport { useNotifications } from '../contexts/NotificationsContext';\nimport '../styles/chat.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Chat() {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [text, setText] = useState('');\n  const [loading, setLoading] = useState(true);\n  const listRef = useRef(null);\n  const {\n    add\n  } = useNotifications();\n  useEffect(() => {\n    let mounted = true;\n    async function load() {\n      try {\n        const res = await getChatMessages();\n        if (!mounted) return;\n        const newList = res.messages || [];\n        const totalCount = Array.isArray(newList) ? newList.length : 0;\n\n        // Dispatch total message count\n        try {\n          window.dispatchEvent(new CustomEvent('chat:total-count', {\n            detail: {\n              total: totalCount\n            }\n          }));\n        } catch (e) {/* ignore */}\n        setMessages(newList);\n      } catch (err) {\n        add('Could not load chat messages', {\n          type: 'error'\n        });\n      } finally {\n        setLoading(false);\n      }\n    }\n    load();\n    const iv = setInterval(load, 3000);\n    return () => {\n      mounted = false;\n      clearInterval(iv);\n    };\n  }, [add]);\n  useEffect(() => {\n    if (listRef.current) {\n      listRef.current.scrollTop = listRef.current.scrollHeight;\n    }\n  }, [messages]);\n  const send = async () => {\n    if (!text.trim()) return;\n    const payload = {\n      text: text.trim()\n    };\n    try {\n      const res = await postChatMessage(payload);\n      setText('');\n      if (res && res.message) {\n        setMessages(prev => prev.concat(res.message));\n      } else {\n        const fresh = await getChatMessages();\n        setMessages(fresh.messages || []);\n      }\n    } catch (err) {\n      add('Failed to send message', {\n        type: 'error'\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"brand\",\n      children: /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"brand-heading\",\n        children: \"Community Chat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        textAlign: 'center',\n        color: 'var(--text-secondary)',\n        marginBottom: '20px'\n      },\n      children: \"Connect with fellow adventurers! Share tips, ask questions, and plan your next near-me adventure together.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-container\",\n      ref: listRef,\n      children: loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: 'var(--text-primary)'\n        },\n        children: \"Loading messages...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 11\n      }, this) : messages.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: 'var(--text-primary)'\n        },\n        children: \"No messages yet. Say hello!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 11\n      }, this) : messages.map(m => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-message\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-message-sender\",\n          children: m.senderName || m.sender && (m.sender.name || m.sender.email)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-message-text\",\n          children: m.text\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-message-time\",\n          children: new Date(m.createdAt).toLocaleString()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 15\n        }, this)]\n      }, m._id || m.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-input-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"chat-input\",\n        value: text,\n        onChange: e => setText(e.target.value),\n        onKeyPress: e => e.key === 'Enter' && send(),\n        placeholder: \"Write a message...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"chat-send-button\",\n        onClick: send,\n        children: \"Send\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 5\n  }, this);\n}\n_s(Chat, \"bXcsOMvovr2iLZQNjalHS00HEwU=\", false, function () {\n  return [useNotifications];\n});\n_c = Chat;\nvar _c;\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["React","useEffect","useRef","useState","getChatMessages","postChatMessage","useNotifications","jsxDEV","_jsxDEV","Chat","_s","messages","setMessages","text","setText","loading","setLoading","listRef","add","mounted","load","res","newList","totalCount","Array","isArray","length","window","dispatchEvent","CustomEvent","detail","total","e","err","type","iv","setInterval","clearInterval","current","scrollTop","scrollHeight","send","trim","payload","message","prev","concat","fresh","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","textAlign","color","marginBottom","ref","map","m","senderName","sender","name","email","Date","createdAt","toLocaleString","_id","id","value","onChange","target","onKeyPress","key","placeholder","onClick","_c","$RefreshReg$"],"sources":["C:/Users/User/Desktop/CSE425 mp/NM adventures Final (1)/NM adventures Final/frontend/src/pages/Chat.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { getChatMessages, postChatMessage } from '../services/api';\r\nimport { useNotifications } from '../contexts/NotificationsContext';\r\nimport '../styles/chat.css';\r\n\r\nexport default function Chat() {\r\n  const [messages, setMessages] = useState([]);\r\n  const [text, setText] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const listRef = useRef(null);\r\n  const { add } = useNotifications();\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      try {\r\n        const res = await getChatMessages();\r\n        if (!mounted) return;\r\n        const newList = res.messages || [];\r\n        const totalCount = Array.isArray(newList) ? newList.length : 0;\r\n\r\n        // Dispatch total message count\r\n        try {\r\n          window.dispatchEvent(new CustomEvent('chat:total-count', { detail: { total: totalCount } }));\r\n        } catch (e) { /* ignore */ }\r\n\r\n        setMessages(newList);\r\n      } catch (err) {\r\n        add('Could not load chat messages', { type: 'error' });\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    const iv = setInterval(load, 3000);\r\n    return () => { mounted = false; clearInterval(iv); };\r\n  }, [add]);\r\n\r\n  useEffect(() => {\r\n    if (listRef.current) {\r\n      listRef.current.scrollTop = listRef.current.scrollHeight;\r\n    }\r\n  }, [messages]);\r\n\r\n  const send = async () => {\r\n    if (!text.trim()) return;\r\n    const payload = { text: text.trim() };\r\n    try {\r\n      const res = await postChatMessage(payload);\r\n      setText('');\r\n      if (res && res.message) {\r\n        setMessages(prev => prev.concat(res.message));\r\n      } else {\r\n        const fresh = await getChatMessages();\r\n        setMessages(fresh.messages || []);\r\n      }\r\n    } catch (err) {\r\n      add('Failed to send message', { type: 'error' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"page\">\r\n      <div className=\"brand\">\r\n        <h2 className=\"brand-heading\">Community Chat</h2>\r\n      </div>\r\n      <p style={{ textAlign: 'center', color: 'var(--text-secondary)', marginBottom: '20px' }}>\r\n        Connect with fellow adventurers! Share tips, ask questions, and plan your next near-me adventure together.\r\n      </p>\r\n\r\n      <div className=\"chat-container\" ref={listRef}>\r\n        {loading ? (\r\n          <p style={{ color: 'var(--text-primary)' }}>Loading messages...</p>\r\n        ) : messages.length === 0 ? (\r\n          <p style={{ color: 'var(--text-primary)' }}>No messages yet. Say hello!</p>\r\n        ) : (\r\n          messages.map(m => (\r\n            <div key={m._id || m.id} className=\"chat-message\">\r\n              <div className=\"chat-message-sender\">\r\n                {m.senderName || (m.sender && (m.sender.name || m.sender.email))}\r\n              </div>\r\n              <div className=\"chat-message-text\">{m.text}</div>\r\n              <div className=\"chat-message-time\">\r\n                {new Date(m.createdAt).toLocaleString()}\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"chat-input-container\">\r\n        <input \r\n          className=\"chat-input\"\r\n          value={text} \r\n          onChange={e => setText(e.target.value)} \r\n          onKeyPress={e => e.key === 'Enter' && send()}\r\n          placeholder=\"Write a message...\" \r\n        />\r\n        <button className=\"chat-send-button\" onClick={send}>Send</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}